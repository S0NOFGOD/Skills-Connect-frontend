<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Dashboard â€” SkillConnect</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
<style>
body {
  font-family:'Montserrat',sans-serif;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:flex-start;
  min-height:100vh;
  padding-top:50px;
}
.container {
  background:rgba(255,255,255,0.08);
  backdrop-filter:blur(20px);
  border-radius:20px;
  padding:30px;
  text-align:center;
  width:90%;
  max-width:400px;
}
img {
  border-radius:50%;
  width:120px;
  height:120px;
  object-fit:cover;
  margin-bottom:20px;
}
h1 { margin-bottom:10px; }
p { margin:5px 0; }
button {
  padding:10px 20px;
  margin-top:15px;
  margin-right:10px;
  border:none;
  border-radius:12px;
  background:linear-gradient(135deg,#00c6ff,#0072ff);
  color:#fff;
  font-weight:600;
  cursor:pointer;
  transition:0.3s;
}
button:hover{ transform:scale(1.05); }
input, select {
  width:100%;
  padding:12px;
  margin:8px 0;
  border-radius:12px;
  border:none;
  outline:none;
  font-size:14px;
  background:rgba(255,255,255,0.15);
  color:#fff;
}
select option{ color:#000; }
#error-msg { color:#ff4b5c; font-size:14px; margin-bottom:10px; }
#edit-form { display:none; text-align:left; margin-top:20px; }
#edit-form label { display:block; margin:5px 0 2px; }
#get-location-btn{background:linear-gradient(135deg,#ffb347,#ffcc33);color:#000;font-weight:600;cursor:pointer;margin-bottom:10px;}
</style>
</head>
<body>

<div class="container">
  <img id="user-image" src="" alt="Profile Image" />
  <h1 id="user-name"></h1>
  <p>Email: <span id="user-email"></span></p>
  <p>Phone: <span id="user-phone"></span></p>
  <p>Location: <span id="user-location"></span></p>
  <p>Skill: <span id="user-skill"></span></p>

  <!-- Buttons -->
  <button id="about-btn">About Me</button>
  <button id="edit-btn">Edit Profile</button>
  <button id="logout-btn">Logout</button>

  <!-- Edit Form -->
  <div id="edit-form">
    <div id="error-msg"></div>

    <label for="edit-name">Full Name</label>
    <input type="text" id="edit-name" />

    <label for="edit-phone">Phone</label>
    <input type="text" id="edit-phone" />

    <button type="button" id="get-location-btn">Use My Current Location</button>
    <label for="edit-location">Location</label>
    <input type="text" id="edit-location" readonly />

    <label for="edit-skill">Skill</label>
    <select id="edit-skill">
      <option value="">Select Skill</option>
      <option>Barber</option>
      <option>Phone Repairer</option>
      <option>Electrician</option>
      <option>Plumber</option>
      <option>Web Developer</option>
      <option>Cleaner</option>
    </select>

    <label for="edit-image">Profile Image</label>
    <input type="file" id="edit-image" accept="image/*" />

    <button id="save-btn">Save Changes</button>
  </div>
</div>

<script>
const BACKEND_URL = "https://skillconnect-backend-uv3z.onrender.com";

let user = JSON.parse(localStorage.getItem('currentUser'));
if(!user){ window.location.href = "index.html"; }

// Populate dashboard
function populateDashboard(){
  document.getElementById('user-name').innerText = user.name || '';
  document.getElementById('user-email').innerText = user.email || '';
  document.getElementById('user-phone').innerText = user.phone || '';
  document.getElementById('user-location').innerText = user.location || '';
  document.getElementById('user-skill').innerText = user.skill || '';
  document.getElementById('user-image').src = user.image || "https://via.placeholder.com/120";
}
populateDashboard();

// Logout
document.getElementById('logout-btn').addEventListener('click', ()=>{
  localStorage.removeItem('currentUser');
  window.location.href = "index.html";
});

// Toggle edit form
document.getElementById('edit-btn').addEventListener('click', ()=>{
  const form = document.getElementById('edit-form');
  form.style.display = form.style.display==='none' ? 'block' : 'none';

  // Fill form with current values
  document.getElementById('edit-name').value = user.name || '';
  document.getElementById('edit-phone').value = user.phone || '';
  document.getElementById('edit-location').value = user.location || '';
  document.getElementById('edit-skill').value = user.skill || '';
});

// Location finder in edit form
document.getElementById('get-location-btn').addEventListener('click', ()=>{
  const locationInput = document.getElementById('edit-location');
  if(navigator.geolocation){
    locationInput.value = "Loading. hold on";
    navigator.geolocation.getCurrentPosition(async (position)=>{
      const {latitude, longitude} = position.coords;
      try{
        const res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${latitude}&lon=${longitude}`);
        const data = await res.json();
        const city = data.address.city || data.address.town || data.address.village || '';
        const state = data.address.state || '';
        locationInput.value = city && state ? `${city}, ${state}` : '';
      }catch(err){
        locationInput.value = '';
        alert("Could not fetch location");
      }
    }, ()=>{
      locationInput.value = '';
      alert("Geolocation permission denied");
    });
  } else {
    alert("Geolocation is not supported by your browser");
  }
});

// Save changes
document.getElementById('save-btn').addEventListener('click', async ()=>{
  const name = document.getElementById('edit-name').value.trim();
  const phone = document.getElementById('edit-phone').value.trim();
  const location = document.getElementById('edit-location').value.trim();
  const skill = document.getElementById('edit-skill').value;
  const imageFile = document.getElementById('edit-image').files[0];
  const error = document.getElementById('error-msg'); error.innerText = '';

  if(!name || !phone || !location || !skill){
    error.innerText = "All fields are required!";
    return;
  }

  let imageData = user.image || null;
  if(imageFile){
    const reader = new FileReader();
    reader.onload = async function(){
      imageData = reader.result;
      await updateProfile();
    }
    reader.readAsDataURL(imageFile);
  } else {
    await updateProfile();
  }

  async function updateProfile(){
    try {
      await fetch(`${BACKEND_URL}/update-user`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email: user.email, name, phone, location, skill, image: imageData })
      });

      user = { ...user, name, phone, location, skill, image: imageData };
      localStorage.setItem('currentUser', JSON.stringify(user));

      populateDashboard();
      alert("Profile updated successfully!");
      document.getElementById('edit-form').style.display = 'none';
    } catch(err){
      console.error(err);
      error.innerText = "Failed to update profile.";
    }
  }
});

// --------------------
// About Me Button
// --------------------
document.getElementById('about-btn').addEventListener('click', ()=>{
  localStorage.setItem('premiumProfile', JSON.stringify({
    name: user.name,
    email: user.email,
    phone: user.phone,
    location: user.location,
    skill: user.skill,
    image: user.image,
    education: "B.Sc. Computer Science, University of Lagos" // Example
  }));
  window.location.href = "about-me.html";
});
</script>
</body>
  </html>
